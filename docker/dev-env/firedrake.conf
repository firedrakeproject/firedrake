# Set the main path here
export FIREDRAKE_HOME=/home/firedrake/build
#----------Environment variables---------#
export PATH=${FIREDRAKE_HOME}/bin:${PATH}
export LD_LIBRARY_PATH=${FIREDRAKE_HOME}/lib:$LD_LIBRARY_PATH
export PKG_CONFIG_PATH=${FIREDRAKE_HOME}/lib/pkgconfig:$PKG_CONFIG_PATH
export PYTHONPATH=${FIREDRAKE_HOME}/lib/python2.7/site-packages:$PYTHONPATH
export MANPATH=${FIREDRAKE_HOME}/share/man:$MANPATH
export SRC_DIR=${FIREDRAKE_HOME}/src
mkdir -p $FIREDRAKE_HOME
mkdir -p $SRC_DIR
mkdir -p ${FIREDRAKE_HOME}/lib/python2.7/site-packages
#----------Update definitions---------#
pull_ffc () {
    echo "FIREDRAKE-BUILDER: Pulling ffc..."
    cd $SRC_DIR
    if [ -d ffc ]
    then
      cd ffc
      git pull
    else
      git clone https://bitbucket.org/mapdes/ffc.git
      cd ffc
    fi
}
build_ffc () {
    echo "FIREDRAKE-BUILDER: Building ffc..."
    if [ -d $SRC_DIR/ffc ]
    then
      cd $SRC_DIR/ffc
      python setup.py install --prefix=$FIREDRAKE_HOME
    else
      echo "FIREDRAKE-BUILDER: ffc source cannot be found. Please run pull_ffc first."
    fi
}
update_ffc () {
    pull_ffc
    build_ffc
}

pull_fiat () {
    echo "FIREDRAKE-BUILDER: Pulling fiat..."
    cd $SRC_DIR
    if [ -d fiat ]
    then
      cd fiat
      git pull
    else
        git clone https://bitbucket.org/mapdes/fiat.git
        cd fiat
    fi
}
build_fiat () {
    echo "FIREDRAKE-BUILDER: Building fiat..."
    if [ -d $SRC_DIR/fiat ]
    then
      cd $SRC_DIR/fiat
      python setup.py install --prefix=$FIREDRAKE_HOME
    else
      echo "FIREDRAKE-BUILDER: fiat source cannot be found. Please run pull_fiat first."
    fi
}
update_fiat () {
    pull_fiat
    build_fiat
}

pull_instant () {
    echo "FIREDRAKE-BUILDER: Pulling instant..."
    cd $SRC_DIR
    if [ -d instant ]
    then
      cd instant
      git pull
    else
      git clone https://bitbucket.org/fenics-project/instant.git
      cd instant
    fi
}
build_instant () {
    echo "FIREDRAKE-BUILDER: Building instant..."
    if [ -d $SRC_DIR/instant ]
    then
      cd $SRC_DIR/instant
      python setup.py install --prefix=$FIREDRAKE_HOME
    else
      echo "FIREDRAKE-BUILDER: instant source cannot be found. Please run pull_instant first."
    fi
}
update_instant () {
    pull_instant
    build_instant
}

pull_ufl () {
    echo "FIREDRAKE-BUILDER: Updating ufl..."
    cd $SRC_DIR
    if [ -d ufl ];
    then
      cd ufl
      git pull
    else
      git clone https://bitbucket.org/mapdes/ufl.git
      cd ufl
    fi
}
build_ufl () {
    echo "FIREDRAKE-BUILDER: Building ufl..."
    if [ -d $SRC_DIR/ufl ]
    then
      cd $SRC_DIR/ufl
      python setup.py install --prefix=$FIREDRAKE_HOME
    else
      echo "FIREDRAKE-BUILDER: ufl source cannot be found. Please run pull_ufl first."
    fi
}
update_ufl () {
    pull_ufl
    build_ufl
}

pull_pyop2 () {
    echo "FIREDRAKE-BUILDER: Updating pyop2..."
    cd $SRC_DIR
    if [ -d PyOP2 ];
    then
      cd PyOP2
      git pull
    else
      git clone https://github.com/OP2/PyOP2.git
      cd PyOP2
    fi
}
build_pyop2 () {
    echo "FIREDRAKE-BUILDER: Building pyop2..."
    if [ -d $SRC_DIR/PyOP2 ]
    then
      cd $SRC_DIR/PyOP2
      python setup.py install --prefix=$FIREDRAKE_HOME
    else
      echo "FIREDRAKE-BUILDER: pyop2 source cannot be found. Please run pull_pyop2 first."
    fi
}
update_pyop2 () {
    pull_pyop2
    build_pyop2
}

pull_fdrake () {
    echo "FIREDRAKE-BUILDER: Updating firedrake..."
    cd $SRC_DIR
    if [ -d firedrake ];
    then
      cd firedrake
      git pull
    else
      git clone https://github.com/firedrakeproject/firedrake.git
      cd firedrake
    fi
}
build_fdrake () {
    echo "FIREDRAKE-BUILDER: Building firedrake..."
    if [ -d $SRC_DIR/firedrake ]
    then
      cd $SRC_DIR/firedrake
      python setup.py install --prefix=$FIREDRAKE_HOME
    else
      echo "FIREDRAKE-BUILDER: firedrake source cannot be found. Please run pull_firedrake first."
    fi
}
update_fdrake () {
    pull_fdrake
    build_fdrake
}

pull_firedrake () {
    pull_ffc
    pull_fiat
    pull_instant
    pull_ufl
    pull_pyop2
    pull_fdrake
}
build_firedrake () {
    build_ffc
    build_fiat
    build_instant
    build_ufl
    build_pyop2
    build_fdrake
}
update_firedrake () {
    pull_firedrake
    build_firedrake
    cd "${FIREDRAKE_HOME}/.."
    printf "\033c"
    echo "Firedrake compilation has finished. "
    echo "Environment variables are already set up automatically."
    echo ""
    echo "The full build is in ${FIREDRAKE_HOME} inside the container."
}
